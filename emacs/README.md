# Emacs Terminal Dev Setup

This config is tuned for terminal-based development with:
- C++/CUDA + CMake presets
- Rust + cargo
- Python + uv
- Git workflows in Emacs (via `magit`)

## What Is Included

- LSP via `lsp-mode` for C/C++/CUDA, Rust, and Python
- Terminal-friendly defaults (`tty-escape-delay`, no GUI bars, `xterm-mouse-mode`)
- Project navigation via `projectile`
- VCS with `magit`
- Stack-specific build/test helpers under `C-c m`

## Keybinding Prefix

All build/test helpers are under:

- `C-c m`

### C++/CUDA + CMake presets

- `C-c m c c` -> `cmake --preset <configure-preset>`
- `C-c m c b` -> `cmake --build --preset <build-preset>`
  - Falls back to `cmake --build build/<configure-preset>` if no `buildPresets` exist.
- `C-c m c t` -> `ctest --preset <test-preset>`
  - Falls back to `ctest --test-dir build` if no `testPresets` exist.

Expected project files:
- `CMakePresets.json` at project root

### Rust + cargo

- `C-c m r c` -> `cargo check`
- `C-c m r t` -> `cargo test`
- `C-c m r l` -> `cargo clippy`

Expected project files:
- `Cargo.toml` at project root

### Python + uv

- `C-c m p s` -> `uv sync`
- `C-c m p t` -> `uv run -m pytest`
- `C-c m p r` -> prompt for custom `uv run ...` command
- LSP: install `pyright` (e.g., `npm i -g pyright` or `pipx install pyright`)

Expected project files:
- `pyproject.toml` in the project or a subdir; commands auto-detect the nearest one from the current buffer and will prompt if none is found
- Optional `.venv/` next to `pyproject.toml` (auto-activated in `python-mode`)

## Git Workflow

- Open status: `M-x magit-status`
- Use Projectile to jump between repos and files with `C-c p ...`

## Code Review (Magit + Forge + code-review)

Open or create a Merge Request (MR) / Pull Request (PR):
- `M-x magit-status` in the repo.
- `N f f` (`forge-pull`) to fetch topics; this adds `Pull requests` to the status buffer. citeturn1search7
- Open an existing MR/PR: move point to a PR in `Pull requests` and press `RET` to visit it in a topic buffer. citeturn1search5
- Create a new MR/PR: move point to the `Pull requests` section header and press `C-c C-n`. citeturn0search2

Review and send comments with `code-review`:
- Start a review from a URL: `M-x code-review-start`. citeturn0search0
- Or, in a Forge topic buffer, start the review UI with `M-x code-review-forge-pr-at-point`. citeturn0search0
- Add a comment on a hunk with `RET`, write it, then submit with `C-c C-c`. citeturn0search0
- Add a reply on an existing comment with `RET`, then submit with `C-c C-c`. citeturn0search0

Forge GitLab auth (token from `glab auth status -t`):
- Add a line to `~/.authinfo.gpg` (or `~/.authinfo`) like:
  - `machine gitlab.com login <gitlab-username> password <token>`
- Restart Emacs, then run `M-x forge-pull` to verify access.
- For self-hosted GitLab, replace `gitlab.com` with your instance host.
- If you use `~/.authinfo.gpg`, ensure GPG is working in your terminal session so Emacs can decrypt it (e.g., `gpg -k` prompts succeed, and `pinentry` is available).

## Projectile Cheat Sheet

- `C-c p f` -> find file in project
- `C-c p s g` -> ripgrep search in project
- `C-c p p` -> switch projects
- `C-c p r` -> recent files in project
- `C-c p k` -> kill all project buffers
- `C-c p d` -> open project root directory
- Project roots are detected via `.git` or common build files; add a `.projectile` file at the root if needed.

## Notes

- On Emacs 29+, this setup works well in TTY sessions (tmux/SSH/local terminal).
- For C++/CUDA IntelliSense quality, ensure compile commands are generated by your presets.

## Render Markdown and PlantUML to PDF

Markdown (via `pandoc`):
- Render single file:
  - `pandoc README.md -o README.pdf`
- If you want PDF via LaTeX, ensure a LaTeX engine is installed (e.g. `texlive`).

PlantUML (CLI):
- Render `.puml` to PDF:
  - `plantuml -tpdf diagram.puml`
- Output PDF is created next to the source file.

## Quarto Markdown Slides (`.qmd`)

Quarto files now open in `markdown-mode`.

In any markdown/quarto buffer:
- `C-c q n` -> create a new Quarto slide file with a starter `revealjs` template
- `C-c q s` -> insert a Quarto slide template at point
- `C-c q r` -> run `quarto render <current-file>`

Prerequisite:
- Install Quarto CLI and ensure `quarto` is on your `PATH`.
